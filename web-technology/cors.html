<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.32">
    <link rel="shortcut icon" href="/favicons/favicon.ico"><title>CORS | dailyuno Tech Blog</title><meta name="description" content="">
    <link rel="modulepreload" href="/assets/app.49c6a941.js"><link rel="modulepreload" href="/assets/cors.html.d04dfecc.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/assets/cors.html.d6c1ef7f.js">
    <link rel="stylesheet" href="/assets/style.b5235dab.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">dailyuno Tech Blog</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/html/tags.md" class="sidebar-item sidebar-heading" aria-label="HTML"><!--[--><!--]--> HTML <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/html/tags.html" class="sidebar-item" aria-label="태그"><!--[--><!--]--> 태그 <!--[--><!--]--></a><!----></li><li><a href="/html/semantic-tags.html" class="sidebar-item" aria-label="시맨틱 태그"><!--[--><!--]--> 시맨틱 태그 <!--[--><!--]--></a><!----></li><li><a href="/html/attributes.html" class="sidebar-item" aria-label="속성"><!--[--><!--]--> 속성 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/css/flex.md" class="sidebar-item sidebar-heading" aria-label="CSS"><!--[--><!--]--> CSS <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/css/flex.html" class="sidebar-item" aria-label="Flex"><!--[--><!--]--> Flex <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/javascript/scope.md" class="sidebar-item sidebar-heading" aria-label="Javascript"><!--[--><!--]--> Javascript <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/javascript/event-loop.html" class="sidebar-item" aria-label="이벤트 루프"><!--[--><!--]--> 이벤트 루프 <!--[--><!--]--></a><!----></li><li><a href="/javascript/queues.html" class="sidebar-item" aria-label="큐의 종류"><!--[--><!--]--> 큐의 종류 <!--[--><!--]--></a><!----></li><li><a href="/javascript/prototype.html" class="sidebar-item" aria-label="프로토타입"><!--[--><!--]--> 프로토타입 <!--[--><!--]--></a><!----></li><li><a href="/javascript/this.html" class="sidebar-item" aria-label="this"><!--[--><!--]--> this <!--[--><!--]--></a><!----></li><li><a href="/javascript/scope.html" class="sidebar-item" aria-label="스코프"><!--[--><!--]--> 스코프 <!--[--><!--]--></a><!----></li><li><a href="/javascript/hoisting.html" class="sidebar-item" aria-label="호이스팅"><!--[--><!--]--> 호이스팅 <!--[--><!--]--></a><!----></li><li><a href="/javascript/XMLHttpRequest.html" class="sidebar-item" aria-label="XMLHTTPRequest"><!--[--><!--]--> XMLHTTPRequest <!--[--><!--]--></a><!----></li><li><a href="/javascript/IndexedDB.html" class="sidebar-item" aria-label="IndexedDB"><!--[--><!--]--> IndexedDB <!--[--><!--]--></a><!----></li><li><a href="/javascript/localStorage.html" class="sidebar-item" aria-label="localStorage"><!--[--><!--]--> localStorage <!--[--><!--]--></a><!----></li><li><a href="/javascript/promise.html" class="sidebar-item" aria-label="Promise"><!--[--><!--]--> Promise <!--[--><!--]--></a><!----></li><li><a href="/javascript/iteration-protocols.html" class="sidebar-item" aria-label="이터레이션 프로토콜"><!--[--><!--]--> 이터레이션 프로토콜 <!--[--><!--]--></a><!----></li><li><a href="/javascript/generator.html" class="sidebar-item" aria-label="제너레이터"><!--[--><!--]--> 제너레이터 <!--[--><!--]--></a><!----></li><li><a href="/javascript/async-await.html" class="sidebar-item" aria-label="Async &amp; Await"><!--[--><!--]--> Async &amp; Await <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/typescript/init.md" class="sidebar-item sidebar-heading" aria-label="Typescript"><!--[--><!--]--> Typescript <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/typescript/init.html" class="sidebar-item" aria-label="시작하기"><!--[--><!--]--> 시작하기 <!--[--><!--]--></a><!----></li><li><a href="/typescript/type-annotation.html" class="sidebar-item" aria-label="타입 어노테이션"><!--[--><!--]--> 타입 어노테이션 <!--[--><!--]--></a><!----></li><li><a href="/typescript/primitive-types.html" class="sidebar-item" aria-label="원시 타입"><!--[--><!--]--> 원시 타입 <!--[--><!--]--></a><!----></li><li><a href="/typescript/special-types.html" class="sidebar-item" aria-label="특수 타입"><!--[--><!--]--> 특수 타입 <!--[--><!--]--></a><!----></li><li><a href="/typescript/array-tuple.html" class="sidebar-item" aria-label="배열과 튜플"><!--[--><!--]--> 배열과 튜플 <!--[--><!--]--></a><!----></li><li><a href="/typescript/enum.html" class="sidebar-item" aria-label="열거형"><!--[--><!--]--> 열거형 <!--[--><!--]--></a><!----></li><li><a href="/typescript/enum-issue.html" class="sidebar-item" aria-label="열거형의 문제점"><!--[--><!--]--> 열거형의 문제점 <!--[--><!--]--></a><!----></li><li><a href="/typescript/type-alias.html" class="sidebar-item" aria-label="타입 별칭"><!--[--><!--]--> 타입 별칭 <!--[--><!--]--></a><!----></li><li><a href="/typescript/type-assertion.html" class="sidebar-item" aria-label="타입 단언"><!--[--><!--]--> 타입 단언 <!--[--><!--]--></a><!----></li><li><a href="/typescript/type-guard.html" class="sidebar-item" aria-label="타입 가드"><!--[--><!--]--> 타입 가드 <!--[--><!--]--></a><!----></li><li><a href="/typescript/unions-and-intersections.html" class="sidebar-item" aria-label="유니온과 교차 타입"><!--[--><!--]--> 유니온과 교차 타입 <!--[--><!--]--></a><!----></li><li><a href="/typescript/interface.html" class="sidebar-item" aria-label="인터페이스"><!--[--><!--]--> 인터페이스 <!--[--><!--]--></a><!----></li><li><a href="/typescript/generic.html" class="sidebar-item" aria-label="제네릭"><!--[--><!--]--> 제네릭 <!--[--><!--]--></a><!----></li><li><a href="/typescript/class.html" class="sidebar-item" aria-label="클래스"><!--[--><!--]--> 클래스 <!--[--><!--]--></a><!----></li><li><a href="/typescript/type-compatibility.html" class="sidebar-item" aria-label="타입 호환성"><!--[--><!--]--> 타입 호환성 <!--[--><!--]--></a><!----></li><li><a href="/typescript/type-relationship.html" class="sidebar-item" aria-label="타입 간의 관계"><!--[--><!--]--> 타입 간의 관계 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/react/init.md" class="sidebar-item sidebar-heading" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/react/init.html" class="sidebar-item" aria-label="시작하기"><!--[--><!--]--> 시작하기 <!--[--><!--]--></a><!----></li><li><a href="/react/context-api.html" class="sidebar-item" aria-label="Context API"><!--[--><!--]--> Context API <!--[--><!--]--></a><!----></li><li><a href="/react/higher-order-component.html" class="sidebar-item" aria-label="고차 컴포넌트"><!--[--><!--]--> 고차 컴포넌트 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/react/hooks/init.md" class="sidebar-item sidebar-heading" aria-label="React Hooks"><!--[--><!--]--> React Hooks <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/react/hooks/init.html" class="sidebar-item" aria-label="Hooks이란?"><!--[--><!--]--> Hooks이란? <!--[--><!--]--></a><!----></li><li><a href="/react/hooks/use-state.html" class="sidebar-item" aria-label="useState"><!--[--><!--]--> useState <!--[--><!--]--></a><!----></li><li><a href="/react/hooks/use-effect.html" class="sidebar-item" aria-label="useEffect"><!--[--><!--]--> useEffect <!--[--><!--]--></a><!----></li><li><a href="/react/hooks/use-context.html" class="sidebar-item" aria-label="useContext"><!--[--><!--]--> useContext <!--[--><!--]--></a><!----></li><li><a href="/react/hooks/use-ref.html" class="sidebar-item" aria-label="useRef"><!--[--><!--]--> useRef <!--[--><!--]--></a><!----></li><li><a href="/react/hooks/use-memo.html" class="sidebar-item" aria-label="useMemo"><!--[--><!--]--> useMemo <!--[--><!--]--></a><!----></li><li><a href="/react/hooks/use-callback.html" class="sidebar-item" aria-label="useCallback"><!--[--><!--]--> useCallback <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/redux/init.md" class="sidebar-item sidebar-heading" aria-label="Redux"><!--[--><!--]--> Redux <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/redux/init.html" class="sidebar-item" aria-label="시작하기"><!--[--><!--]--> 시작하기 <!--[--><!--]--></a><!----></li><li><a href="/redux/connect.html" class="sidebar-item" aria-label="connect"><!--[--><!--]--> connect <!--[--><!--]--></a><!----></li><li><a href="/redux/use-dispatch.html" class="sidebar-item" aria-label="useDispatch"><!--[--><!--]--> useDispatch <!--[--><!--]--></a><!----></li><li><a href="/redux/use-selector.html" class="sidebar-item" aria-label="useSelector"><!--[--><!--]--> useSelector <!--[--><!--]--></a><!----></li><li><a href="/redux/reselect.html" class="sidebar-item" aria-label="reselect"><!--[--><!--]--> reselect <!--[--><!--]--></a><!----></li><li><a href="/redux/redux-thunk.html" class="sidebar-item" aria-label="redux-thunk"><!--[--><!--]--> redux-thunk <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/web-technology/browser-render.md" class="sidebar-item sidebar-heading active" aria-label="Web Technology"><!--[--><!--]--> Web Technology <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/web-technology/browser-render.html" class="sidebar-item" aria-label="브라우저 렌더링"><!--[--><!--]--> 브라우저 렌더링 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/web-technology/cors.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="CORS"><!--[--><!--]--> CORS <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/computer-science/functional-programming.md" class="sidebar-item sidebar-heading" aria-label="Computer Science"><!--[--><!--]--> Computer Science <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/computer-science/functional-programming.html" class="sidebar-item" aria-label="함수형 프로그래밍"><!--[--><!--]--> 함수형 프로그래밍 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h2 id="들어가며" tabindex="-1"><a class="header-anchor" href="#들어가며" aria-hidden="true">#</a> 들어가며</h2><p>React, Vue와 같은 라이브러리/프레임워크로 SPA 어플리케이션을 만들다 보면 서버로부터 데이터를 받아야 하는 상황이 생긴다. 데이터를 요청하기 위해서는 브라우저 자체적으로 지원하는 <code>XMLHttpRequest</code> 혹은 ES6 이후에 나온 <code>fetch</code>를 사용하거나 <code>axios</code>와 같은 라이브러리를 사용하기도 한다.</p><p>근데 가끔 데이터를 요청하다 보면 아래와 같은 에러가 발생하는 것을 볼 수 있다.</p><div class="custom-container danger"><p class="custom-container-title">CORS 에러</p><p>Access to fetch at <strong>&#39;https://api-example.com/users&#39;</strong> from origin <strong>&#39;http://localhost&#39;</strong> has been blocked by CORS policy: No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource. If an opaque response serves your needs, set the request&#39;s mode to &#39;no-cors&#39; to fetch the resource with CORS disabled.</p></div><p>CORS 정책을 위반할 때, 위와 같은 에러가 발생한다. CORS가 무엇인지에 대해 알아보고, 어떻게 해결해야 하는지에 대해 알아보자.</p><h2 id="cors가-필요한-이유" tabindex="-1"><a class="header-anchor" href="#cors가-필요한-이유" aria-hidden="true">#</a> CORS가 필요한 이유</h2><p>기본적으로 브라우저는 동일 출처 정책(Same-Origin Policy)에 따라 다른 출처의 리소스를 사용할 수 없고, 동일한 출처의 리소스만 사용이 가능하다.</p><p>하지만 실제로 개발을 하다 보면 API를 사용해야 하거나, 구글 웹 폰트의 사용이 필요한 상황이 생긴다. 특히 SPA로 구현된 어플리케이션에서는 API의 요청은 필수가 될 수 밖에 없다.</p><p>이렇게 다른 출처에 요청해야 하는 경우가 많아지고 있어서, 이러한 요청들을 안전하게 처리할 수 있는 방법이 필요했다. 덕분에 CORS가 등장하게 되었으며, CORS는 다른 출처의 요청을 선택적으로 허용함으로써 안전하게 처리할 수 있다.</p><h2 id="동일-출처-정책-same-origin-policy" tabindex="-1"><a class="header-anchor" href="#동일-출처-정책-same-origin-policy" aria-hidden="true">#</a> 동일 출처 정책 (Same-Origin Policy)</h2><p>보안적인 이유로 브라우저가 동일한 출처의 리소스만 사용할 수 있도록 하는 정책이다. 다른 출처의 리소스를 가지고 오지 못 한다는 단점이 있으나, <strong>XSS</strong>, <strong>XSRF</strong>와 같은 공격을 방어할 수 있다. 하지만 다른 출처로 요청할 수 없게 되면 웹 어플리케이션은 한계를 맞이할 수 밖에 없게 된다. 즉 기본적으로는 브라우저는 동일 출처 정책을 따르지만 예외적으로 CORS를 통해, 다른 출처에 요청할 수 있게 된다.</p><h2 id="cors-교차-출처-리소스-공유" tabindex="-1"><a class="header-anchor" href="#cors-교차-출처-리소스-공유" aria-hidden="true">#</a> CORS (교차 출처 리소스 공유)</h2><p>CORS는 Cross-origin Resource Sharing의 약자로, 교차 출처 리소스 공유라고 번역할 수 있다. 어플리케이션을 서비스하기 위해서는 구글/페이스북과 같은 로그인 연동 혹은 결제 서비스 이용을 할 때, 다른 출처로 요청이 필요할 때가 존재한다. 어플리케이션에서 다른 출처로 요청할 때 cross-origin HTTP 요청을 실행하는데, 보안적인 이유로 요청들을 제한한다. 이 때, 추가 HTTP 헤더를 사용하여, 다른 출처에 접근할 수 있도록 브라우저에 알리는 것을 CORS라고 한다.</p><p>주로 아래와 같은 요청들이 CORS를 사용한다.</p><ul><li>XMLHttpRequest 혹은 Fetch API 호출</li><li>@font-face 사용</li><li>Canvas - drawImage()</li></ul><h3 id="url-구조" tabindex="-1"><a class="header-anchor" href="#url-구조" aria-hidden="true">#</a> URL 구조</h3><p>다른 출처는 단순히 도메인이 다른 경우를 의미하는 걸까? 출처를 구분하기 위해서는 URL의 구조에 대한 이해가 필요하다.</p><p>URL 구조는 아래 이미지와 같다고 볼 수 있다.</p><p><img src="/assets/url-structure.d5b41063.png" alt="URL-Structure"></p><p>모든 URL이 다음과 같은 구조는 아니지만 기본적으로 프로토콜, 도메인, 주소까지는 필수 요소라고 보면 된다. 그리고 프로토콜의 HTTP와 HTTPS는 각각 80과 443 포트를 사용하는데, 이는 생략 가능하다.</p><h3 id="다른-출처-구분" tabindex="-1"><a class="header-anchor" href="#다른-출처-구분" aria-hidden="true">#</a> 다른 출처 구분</h3><p>먼저 출처(origin)에 대해서 알아야 하는데, 프로토콜과 도메인 그리고 포트를 합친 것을 출처라고 이야기한다. 다음과 같이 <code>location.origin</code> 명령어를 통해 출처를 확인할 수 있다.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 현재 주소 : https://blog.example.com:8080/posts?page=1&amp;tag=cors#content</span>
location<span class="token punctuation">.</span>origin 
<span class="token string">&quot;https://blog.example.com:8080&quot;</span> <span class="token comment">// 출처</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>프토토콜, 도메인, 포트 어느 하나라도 다른 경우에는 다른 출처로 구분된다. 기준이 되는 현재 주소가 &quot;https://blog.example.com:8080&quot;이라고 가정할 때, 같은 출처와 다른 출처는 다음과 같다.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token string">&quot;https://blog.example.com:8080/posts&quot;</span> <span class="token comment">// 같은 출처</span>
<span class="token string">&quot;https://blog.example.com:8080/posts?page=1&quot;</span> <span class="token comment">// 같은 출처</span>
<span class="token string">&quot;https://blog.example.com:3000&quot;</span> <span class="token comment">// 다른 출처</span>
<span class="token string">&quot;https://api.example.com&quot;</span> <span class="token comment">// 다른 출처</span>
<span class="token string">&quot;http://blog.example.com:8080&quot;</span> <span class="token comment">// 다른 출처</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="cors-요청-방법" tabindex="-1"><a class="header-anchor" href="#cors-요청-방법" aria-hidden="true">#</a> CORS 요청 방법</h2><p>브라우저 관점에서 봤을 때, CORS 요청은 두 가지 종류로 구분할 수 있다.</p><ol><li>안전한 요청 - 단순 요청 방법</li><li>안전하지 않은 요청 - 사전 요청 방법</li></ol><h3 id="단순-요청-simple-request" tabindex="-1"><a class="header-anchor" href="#단순-요청-simple-request" aria-hidden="true">#</a> 단순 요청 (Simple Request)</h3><p>단순 요청은 사전 요청 없이 서버에게 바로 요청을 보내는 방법이다.</p><p>예를 들어 &quot;https://blog.example.com&quot;에서 데이터를 받기 위해, &quot;https://api.example.com/posts&quot;로 요청을 보낸다고 가정하면 헤더는 다음의 형태를 가진다.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /posts
HOST: api.example.com
Origin: https://blog.example.com
...
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>서버는 요청 헤더에 있는 출처(Origin)를 확인하는데, <code>Access-Control-Allow-Origin</code>에 설정된 값이 <code>*</code> 혹은 요청한 출처 정보가 있는 경우에는 응답은 성공하고 그렇지 않은 경우 실패하게 된다.</p><p>단순 요청이 되기 위해서는 아래 조건들을 충족해야 한다. (이외에도 추가 조건들이 존재한다.)</p><ul><li>요청 메소드는 GET, HEAD, POST 중 하나여야 한다.</li><li>브라우저에서 자동으로 설정한 헤더 외에는 <code>Accept</code>, <code>Accept-Language</code>, <code>Content-Language</code>, <code>Content-Type</code> 이외의 헤더를 설정할 수 없다.</li><li>Content-Type 헤더는 <code>application/x-www-form-urlencoded</code>, <code>multipart/form-data</code>, <code>text/plain</code> 중 하나를 사용해야 한다.</li></ul><h3 id="사전-요청-preflight-request" tabindex="-1"><a class="header-anchor" href="#사전-요청-preflight-request" aria-hidden="true">#</a> 사전 요청 (Preflight Request)</h3><p>REST API의 경우, GET과 POST 메소드 뿐만 아니라 PUT, DELETE, PATCH 등 다양한 메소드를 사용한다. 이렇게 허용하지 않는 메소드를 사용한 요청이 들어오면 서버에 바로 요청을 보내지 않고, 사전 요청을 보내고 권한이 있는지를 확인한다.</p><p>사전 요청은 <code>OPTIONS</code> 메소드를 통해, 안전한 요청인지를 확인한다.</p><ul><li><code>Access-Control-Request-Method</code>: 안전하지 않은 요청에서 사용하는 메소드 정보</li><li><code>Access-Control-Request-Headers</code>: 안전하지 않은 요청에서 사용하는 헤더의 목록</li></ul><p>서버에서 안전하지 않은 요청을 허용한 경우, 상태 코드 200과 아래 헤더들을 포함해 브라우저로 보낸다.</p><ul><li><code>Access-Control-Allow-Origin</code>: 허용된 출처 정보</li><li><code>Access-Control-Allow-Methods</code>: 허용된 메소드 정보</li><li><code>Access-Control-Allow-Headers</code>: 허용된 헤더의 목록</li><li><code>Access-Control-Max-Age</code>: 권한 허용을 캐싱한 시간</li></ul><p>사전 요청은 다음과 같은 단계로 진행 된다.</p><ol><li>사전 요청</li><li>사전 요청에 대한 응답</li><li>실제 요청</li><li>실제 요청에 대한 응답</li></ol><h2 id="http-응답-헤더" tabindex="-1"><a class="header-anchor" href="#http-응답-헤더" aria-hidden="true">#</a> HTTP 응답 헤더</h2><p>XHR 혹은 Fetch API로 요청 시, 크롬 개발자도구 Network 탭에서 다음과 같은 화면을 본 적이 있을텐데, 응답 헤더(Response Headers)에 대해 알아보자.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Response Headers
  Access-Control-Allow-Credentials: false
  Access-Control-Allow-Headers: *
  Access-Control-Allow-Methods: GET
  Access-Control-Allow-Origin: *
  Access-Control-Max-Age: 86400
  content-length: 5856
  content-type: application/json
  date: Mon, 31 Jan 2022 08:24:32 GMT
  server: AmazonS3
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="access-control-allow-origin" tabindex="-1"><a class="header-anchor" href="#access-control-allow-origin" aria-hidden="true">#</a> Access-Control-Allow-Origin</h3><p>허용하고자 하는 출처를 지정하여, 해당 출처가 리소스에 접근할 수 있도록 허용한다.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Access-Control-Allow-Origin: https://blog.example.com
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>다음과 같이 <code>*</code>로 설정한 경우, 출처에 관계없이 모든 리소스에 접근하도록 허용한다.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Access-Control-Allow-Origin: *
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="access-control-allow-methods" tabindex="-1"><a class="header-anchor" href="#access-control-allow-methods" aria-hidden="true">#</a> Access-Control-Allow-Methods</h3><p>리소스에 접근할 때 허용하는 메소드를 지정한다. 다음과 같이 GET, POST, PUT, DELETE 등의 HTTP 메소드를 지정하면 된다.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Access-Control-Allow-Methods: GET, POST
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="access-control-allow-headers" tabindex="-1"><a class="header-anchor" href="#access-control-allow-headers" aria-hidden="true">#</a> Access-Control-Allow-Headers</h3><p>사용할 수 있는 헤더를 지정한다.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Access-Control-Allow-Methods: Content-Type, Authorization
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="access-control-max-age" tabindex="-1"><a class="header-anchor" href="#access-control-max-age" aria-hidden="true">#</a> Access-Control-Max-Age</h3><p>preflight 요청 결과를 캐시할 수 있는 시간을 지정한다.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Access-Control-Max-Age: 3600 // 1시간
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="access-control-expose-headers" tabindex="-1"><a class="header-anchor" href="#access-control-expose-headers" aria-hidden="true">#</a> Access-Control-Expose-Headers</h3><p>브라우저에서 접근할 수 있는 헤더를 지정한다.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Access-Control-Expose-Headers: X-My-Custom-Header, X-Another-Custom-Header
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="access-control-allow-credentials" tabindex="-1"><a class="header-anchor" href="#access-control-allow-credentials" aria-hidden="true">#</a> Access-Control-Allow-Credentials</h3><p>요청한 <code>credentials</code> 값이 true일 경우, 응답을 표시할 건지에 대해 지정한다.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Access-Control-Allow-Credentials: true
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>출처가 다른 경우, request header에 쿠키가 자동으로 들어가지 않기 때문에, 쿠키를 넣기 위해서는 작업이 필요하다. 서버의 응답 헤더에서는 허용되어야 하며, 요청 시에도 다음과 같은 작업이 필요하다.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// XHR 사용</span>
<span class="token keyword">const</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
req<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&#39;GET&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;http://blog.example.com&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
req<span class="token punctuation">.</span>withCredentials <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
req<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Fetch API 사용</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;http://blog.example.com&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  credentials<span class="token operator">:</span> <span class="token string">&quot;include&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 34119537+dailyuno@users.noreply.github.com">dailyuno</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/web-technology/browser-render.html" class="" aria-label="브라우저 렌더링"><!--[--><!--]--> 브라우저 렌더링 <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.49c6a941.js" defer></script>
  </body>
</html>
